---
id: BUG-002
title: "Security policy blocks Parsley module imports"
status: resolved
severity: high
created: 2025-11-30
reporter: "@human"
---

# BUG-002: Security policy blocks Parsley module imports

## Summary
Parsley's `import` statement fails because the security policy blocks script execution, making Parsley's module system unusable.

## Observed Behavior
When a Parsley script tries to import another module:
```parsley
{Page} = import (@./Page.pars)
```

The server returns an error:
```
[ERROR] script error in /Users/samphillips/Dev/basil/examples/hello/handlers/index.pars: security: script execution not allowed: /Users/samphillips/Dev/basil/examples/hello/handlers/Page.pars (use --allow-execute or -x)
```

## Expected Behavior
Parsley scripts should be able to import other Parsley modules. The security policy should allow execution of `.pars`/`.parsley` files within the handlers directory (or a configured safe zone).

## Reproduction Steps
1. Create a Parsley module file `handlers/Page.pars`
2. Try to import it from `handlers/index.pars` using `{Page} = import (@./Page.pars)`
3. Run `basil --dev`
4. Visit `http://localhost:8080/`
5. Error is returned

## Environment
- OS: macOS
- Go version: 1.21+
- Basil version: Phase 1 MVP (feat/FEAT-002-basil-server branch)

---
<!-- BELOW THIS LINE: AI-FOCUSED INVESTIGATION DETAILS -->

## Investigation Notes

### Root Cause
The security policy in `server/handler.go` set `AllowExecute: []string{}`, blocking all script execution including Parsley's `import` statement.

### Affected Code
- `server/handler.go` â€” SecurityPolicy configuration

## Resolution

### Fix Description
Changed `AllowExecute` to include the handler's directory (`filepath.Dir(h.scriptPath)`), allowing imports from the same directory tree while still preventing arbitrary script execution.

### Test Coverage
Existing tests pass; manual testing confirmed module imports work.

## Related
- Fix commit: `2f587bf`
- Related bugs: BUG-001 (fixed together)
- Related features: FEAT-002 (Basil Web Server)
