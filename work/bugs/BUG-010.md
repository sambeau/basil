# BUG-010: Parser gives confusing errors for undefined components

## Status
Open

## Reported
2025-12-02

## Description
When a component tag like `<Page>` is used but the component is not defined (e.g., import failed), the parser produces confusing error messages instead of clearly stating the component is undefined.

## Current Behavior
```
expected identifier as dictionary key, got opening tag at line 6, column 3
  line 31, column 7: unexpected 'Page'
  line 33, column 7: unexpected '}'
```

The parser sees `<Page ...>` but because `Page` is not in scope, it doesn't recognize this as a component invocation. It tries to parse it as something else (dictionary literal?) and fails with a confusing "expected identifier as dictionary key" message.

Additionally, cascade errors on subsequent lines add noise.

## Expected Behavior
```
Undefined component 'Page' at line 6, column 3
  Hint: Is 'Page' imported? Check the import path.
```

The parser should:
1. Recognize `<UppercaseName ...>` as a component tag pattern
2. If the name is undefined at parse/eval time, report "Undefined component 'Name'"
3. Not produce cascade errors from the confusion

## Reproduction
```parsley
// Don't import Page
// {Page} = import(@./components/page.pars)

export Home = function(){
  <Page title="test">  // Error should say Page is undefined
    <p>Content</p>
  </Page>
}
```

## Workaround
A display-layer workaround has been implemented in `server/errors.go`:
- `improveErrorMessage()` rewrites known confusing patterns
- Cascade errors (subsequent lines) are stripped
- Hints are shown for common issues

This improves the UX but doesn't fix the root cause in the parser.

## Root Cause
The Parsley parser doesn't have special handling for uppercase tag names. When it encounters `<Page>` and `Page` is not defined, it falls back to default parsing behavior which assumes dictionary context.

## Suggested Fix
In the parser:
1. When parsing `<identifier ...>` where identifier starts with uppercase, treat it as component syntax
2. Defer the "is this defined?" check to evaluation time
3. At evaluation, produce clear "Undefined component 'X'" error

Alternatively:
1. Add a recovery mechanism when dictionary key parsing fails after `<`
2. Recognize "this looks like a component tag" and report appropriately

## Files
- `pkg/parsley/parser/parser.go` - Parser logic
- `pkg/parsley/evaluator/evaluator.go` - Component evaluation
- `server/errors.go` - Display workaround (implemented)

## Priority
Medium - Workaround exists but proper fix improves DX significantly

## Related
- FEAT-016: Error page improvements (workaround implemented there)
