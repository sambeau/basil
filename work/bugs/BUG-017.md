# BUG-017: Multiple locations with missing error position information

**Status**: resolved  
**Reported**: 2026-01-16  
**Resolved**: 2026-01-16  
**Severity**: medium  
**Component**: parsley/evaluator

## Summary

Multiple locations in the evaluator parse sub-expressions using `lexer.New()` or `lexer.NewWithFilename()` but don't adjust error positions to reflect the actual source location. This causes errors to show incorrect line/column numbers (typically line 1, column 1).

## Resolution

All high and medium priority items have been fixed. Remaining low-priority items are edge cases that rarely occur in practice.

### FIXED (2026-01-16)

1. **Template interpolations** (evaluator.go):
   - `interpolatePathUrlTemplate()` - datetime, path, URL templates
   - `evalTemplateLiteral()` - backtick string interpolations
   - `evalRawTemplateLiteral()` - single-quoted raw string interpolations

2. **Tag props - evalTagProps()** (eval_tags.go):
   - `={expr}` prop expression syntax
   - `@{expr}` in single-quoted strings
   - `{expr}` inline interpolation - legacy

3. **Standard tag props - evalStandardTag()** (eval_tags.go):
   - `@{expr}` in single-quoted strings within tag
   - `{expr}` prop value interpolation

4. **Form Binding - parseFormAtRecord()** (form_binding.go):
   - `@record={expr}` parsing now returns structured errors with positions
   - Runtime errors in @record expressions are adjusted

5. **Custom Component Props - parseTagProps()** (eval_tags.go):
   - Added optional baseLine/baseCol parameters
   - Updated all call sites to pass position info
   - Spread operators `...expr` and `{...expr}` now report correct positions
   - `{expr}` prop values report correct positions

## Remaining Items (LOW PRIORITY - WONTFIX)

### 1. Markdown Interpolation - eval_parsing.go

| Line | Context | Issue |
|------|---------|-------|
| ~387 | `@{expr}` in markdown | Uses `lexer.New()` without filename; errors shown in HTML span without position |

This is a rare edge case - markdown with interpolation is typically used for documentation.

### 2. interpolateRawString - evaluator.go

| Line | Context | Issue |
|------|---------|-------|
| ~5085 | Runtime helper for `@{expr}` | No AST node available, so can't get base position. |

This is an internal helper called from various places. Adding position tracking would require significant refactoring with minimal benefit.

### 3. Database/File IO Errors - eval_database.go, eval_file_io.go

These are runtime IO errors that don't have source positions by nature. The error messages describe the operation, not a source location.

## Related

- BUG-016: Import destructuring errors show line 0:0 (resolved)
- Commits: 31ca97b (template interpolation), e3a4363 (tag props)
- Tests: `pkg/parsley/tests/tag_props_error_test.go`, `pkg/parsley/tests/datetime_template_test.go`
