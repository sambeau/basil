# BUG-017: Multiple locations with missing error position information

**Status**: partially-resolved  
**Reported**: 2026-01-16  
**Severity**: medium  
**Component**: parsley/evaluator

## Summary

Multiple locations in the evaluator parse sub-expressions using `lexer.New()` or `lexer.NewWithFilename()` but don't adjust error positions to reflect the actual source location. This causes errors to show incorrect line/column numbers (typically line 1, column 1).

## Progress

### FIXED (2026-01-16)

1. **Template interpolations** (evaluator.go):
   - `interpolatePathUrlTemplate()` - datetime, path, URL templates
   - `evalTemplateLiteral()` - backtick string interpolations
   - `evalRawTemplateLiteral()` - single-quoted raw string interpolations

2. **Tag props - evalTagProps()** (eval_tags.go):
   - `={expr}` prop expression syntax (lines ~1038-1070)
   - `@{expr}` in single-quoted strings (lines ~1173-1210)
   - `{expr}` inline interpolation - legacy (lines ~1270-1310)

3. **Standard tag props - evalStandardTag()** (eval_tags.go):
   - `@{expr}` in single-quoted strings within tag (lines ~1640-1680)
   - `{expr}` prop value interpolation (lines ~1740-1780)

## Locations Still Needing Fix

### 1. Tag Props Parsing - eval_tags.go (LOW PRIORITY)

These are less commonly used code paths:

| Line | Context | Issue |
|------|---------|-------|
| ~2005 | Spread `...expr` | parseTagProps needs position params |
| ~2140 | `{...expr}` spread | Same issue |
| ~2232 | `{expr}` prop value in parseTagProps | Same issue |

### 2. Form Binding - form_binding.go (MEDIUM PRIORITY)

| Line | Context | Issue |
|------|---------|-------|
| ~86 | `@record={expr}` parsing | Returns fmt.Errorf without position info |

### 3. Markdown Interpolation - eval_parsing.go (LOW PRIORITY)

| Line | Context | Issue |
|------|---------|-------|
| ~387 | `@{expr}` in markdown | Uses `lexer.New()` without filename; errors shown in HTML span without position |

### 4. interpolateRawString - evaluator.go (LOW PRIORITY)

| Line | Context | Issue |
|------|---------|-------|
| ~5085 | Runtime helper for `@{expr}` | No AST node available, so can't get base position. Called from various places without context. |

### 5. Database/File IO Errors - eval_database.go, eval_file_io.go (WONTFIX)

These create errors without Line/Column/File:
- eval_database.go: lines 24, 90, 159, 295, 346
- eval_file_io.go: lines 348, 386, 396, 402, 406, 415, 421, 425

These are mostly IO/runtime errors that occur during operations (not parsing), so they inherently don't have source positions. The error messages describe the operation, not a source location.

## Related

- BUG-016: Import destructuring errors show line 0:0 (resolved)
- Commit 31ca97b: Fixed template interpolation error positions
- Tests: `pkg/parsley/tests/tag_props_error_test.go`, `pkg/parsley/tests/datetime_template_test.go`
