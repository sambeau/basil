---
id: BUG-005
title: "Inconsistent import behavior for single-value exports vs dictionary exports"
status: open
severity: medium
created: 2025-12-01
reporter: "@human"
---

# BUG-005: Inconsistent import behavior for single-value exports vs dictionary exports

## Summary
Importing a module that exports a single value (not wrapped in a dictionary) fails with confusing errors, and even function exports require dictionary destructuring to work correctly.

## Observed Behavior

### Scenario 1: Single value export (non-function)
```parsley
// logo.pars
export Logo = <img src="/public/images/tubbo_logo.png" alt="Logo" width="200"/>
```

```parsley
// app.pars
Logo = import(@./logo.pars)
{Logo}
```

**Error:** `app.pars: dictionary destructuring requires a dictionary value, got BUILTIN`

### Scenario 2: Single function export
```parsley
// logo.pars
export Logo = fn(){<img src="/public/images/tubbo_logo.png" alt="Logo" width="200"/>}
```

```parsley
// app.pars
Logo = import(@./logo.pars)
<Logo/>
```

**Error:** `app.pars: not a function: DICTIONARY`

### Scenario 3: Workaround (current required pattern)
```parsley
// logo.pars
export Logo = fn(){<img src="/public/images/tubbo_logo.png" alt="Logo" width="200"/>}
```

```parsley
// app.pars
{Logo} = import(@./logo.pars)
<Logo/>
```

**Result:** Success âœ“

## Expected Behavior

The import system should behave consistently. Options:

**Option A (preferred):** All exports are always wrapped in a dictionary, so:
```parsley
// Single export
export Pi = 3.14159
// Imports as dictionary: { Pi: 3.14159 }

{Pi} = import(@./constants.pars)  // Works
```

**Option B:** Single exports can be imported directly without destructuring:
```parsley
Pi = import(@./constants.pars)    // Gets the value directly
// OR
{Pi} = import(@./constants.pars)  // Also works via destructuring
```

**Option C:** Explicit syntax for single-value vs multi-value modules:
```parsley
// Single default export
export default Logo = fn(){...}

// Multiple named exports  
export Pi = 3.14159
export E = 2.71828
```

## Reproduction Steps

1. Create a file `logo.pars` with a single export:
   ```parsley
   export Logo = <img src="/logo.png" alt="Logo"/>
   ```

2. Create a file `app.pars` that imports it:
   ```parsley
   Logo = import(@./logo.pars)
   {Logo}
   ```

3. Run the handler - observe the error

4. Try the function variant and observe the different error

## Environment
- OS: macOS
- Go version: 1.21+
- Basil version: Current development

---
<!-- BELOW THIS LINE: AI-FOCUSED INVESTIGATION DETAILS -->

## Investigation Notes
*Added during investigation*

### Root Cause
The import system appears to always wrap exports in a dictionary structure, but the error messages and assignment behavior don't handle this consistently. When a single value is exported:

1. The value gets wrapped in a dictionary with the export name as key
2. Direct assignment (`Logo = import(...)`) assigns the dictionary, not the value
3. Using the variable then fails because it's a dictionary, not the expected type

### Design Decision Required

**Recommendation:** Option A - Always use dictionary semantics

Rationale:
- Consistent behavior regardless of number of exports
- No special cases for "single export" modules
- Matches common patterns in other languages (ES6 named exports)
- Clear error messages can guide users to correct usage

The import documentation and error messages should clearly indicate that:
- `import()` always returns a dictionary of exports
- Use destructuring to extract values: `{Name} = import(@./file.pars)`
- Multiple values: `{A, B, C} = import(@./file.pars)`

### Affected Code
- Parsley interpreter: Module/import handling
- Error messages need improvement to guide correct usage

## Resolution
*Added after fix*

### Fix Description
TBD - Pending decision on which option to implement.

### Test Coverage
TBD

## Related
- Related features: Module system, import/export functionality
- This is a Parsley language issue, not a Basil-specific issue

