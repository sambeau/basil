---
id: BUG-003
title: "Help flag (-h) shows error message"
status: resolved
severity: low
created: 2025-11-30
reporter: "@human"
---

# BUG-003: Help flag (-h) shows error message

## Summary
Running `basil -h` prints usage but then shows `error: flag: help requested`.

## Observed Behavior
```
$ ./basil -h
Usage of basil:
  -config string
    	Path to config file
  ...
error: flag: help requested
```

## Expected Behavior
Help should print cleanly without an error message.

## Reproduction Steps
1. Build basil: `go build -o basil .`
2. Run: `./basil -h`
3. Error message appears after usage

## Environment
- OS: macOS
- Go version: 1.21+
- Basil version: 0.1.0-dev

---

## Investigation Notes

### Root Cause
Go's `flag` package returns `flag.ErrHelp` when `-h` is passed. With `flag.ContinueOnError`, this error is returned to the caller. The `main()` function then printed it as an error.

### Affected Code
- `main.go` â€” flag parsing and error handling

## Resolution

### Fix Description
1. Import `errors` package to use `errors.Is()`
2. Check for `flag.ErrHelp` after `flags.Parse()` and show custom help instead
3. Set `flags.SetOutput(io.Discard)` to suppress default flag usage output
4. Show custom help on `-h`, `--help`, or invalid flags

### Test Coverage
Existing tests pass; manual testing confirms `-h`, `--help`, `--version`, and invalid flags all work correctly.

## Related
- Fix commit: `307e206`
- Fix branch: `fix/BUG-003-help-flag`
