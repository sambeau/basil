---
id: BUG-008
title: "Absolute path segments[0] is always empty string"
status: resolved
priority: medium
reported: 2025-12-02
resolved: 2025-12-02
reporter: "@human"
---

# BUG-008: Absolute path segments[0] is always empty string

## Observed Behavior
For absolute paths, `path.segments[0]` is always an empty string `""`, making it impossible to access the first directory with index 0.

```parsley
let p = @/home/hello
log(p.segments)        // ["", "home", "hello"]
log(p.segments[0])     // "" (empty!)
log(p.segments[1])     // "home"
```

## Expected Behavior
Users expect `segments[0]` to be the first meaningful path segment:

```parsley
let p = @/home/hello
log(p.segments)        // ["home", "hello"] expected
log(p.segments[0])     // "home" expected
```

## Reproduction Steps
1. Create an absolute path: `let p = @/home/hello`
2. Access segments: `log(p.segments)`
3. Observe first element is empty string

## Environment
- Parsley v0.2.0+
- Any OS

---

## Resolution

**Fixed with Option A**: Remove empty string, use `absolute` flag for reconstruction.

### Changes Made

1. **`cleanPathComponents()`** - Removed empty string prepending for absolute paths
2. **`pathDictToString()`** - Now checks `absolute` flag and prepends `/` when reconstructing
3. **`evalUrlComputedProperty` pathname case** - Always adds leading `/` for URL paths

### New Behavior
```parsley
let p = @/home/hello
log(p.segments)        // ["home", "hello"]
log(p.segments[0])     // "home"
log(p.absolute)          // true
log(toString(p))         // "/home/hello" (correctly reconstructed)
```

### Tests Updated
- path_cleaning_test.go
- path_url_test.go
- computed_properties_test.go
- string_conv_test.go
- operator_test.go

---

## Investigation Notes (Historical)

### Root Cause
This was a **deliberate design decision**, not an accidental bug.

In the original `cleanPathComponents()`:
```go
// For absolute paths, prepend empty string to represent root
// This is the traditional Unix convention: /usr/local â†’ ["", "usr", "local"]
if isAbsolute {
    result = append([]string{""}, result...)
}
```

The empty string enabled reconstruction via `strings.Join(parts, "/")` to produce leading `/`.

### Why This Was Problematic
1. Users expect `components[0]` to be the first directory
2. Every user had to use `components[1]` for absolute paths
3. Off-by-one errors were easy to make
4. The `absolute` boolean already distinguished absolute vs relative paths

## Related
- Path handling in evaluator.go `parsePathString()`, `cleanPathComponents()`, `pathDictToString()`
