# BUG-016: Import destructuring errors show line 0:0 instead of actual position

**Status**: resolved  
**Reported**: 2026-01-16  
**Resolved**: 2026-01-16  
**Severity**: medium  
**Component**: parsley/evaluator

## Summary

Errors during module import destructuring (like missing exports or type mismatches) show `line 0:0` instead of the actual source position, making debugging difficult.

## Observed Behavior

When importing from `@basil/http` or `@std/*` modules with incorrect destructuring, errors show:

```
ERROR DETAILS

Module does not export 'query'
at /Users/samphillips/Dev/bofdi/site/edit/edit.pars:0:0
```

```
ERROR DETAILS

Dictionary destructuring requires a dictionary value, got string
at /Users/samphillips/Dev/bofdi/components/unsafeTable.pars:0:0
```

## Expected Behavior

Errors should show the actual line where the import statement occurs:

```
Module does not export 'query'
at /Users/samphillips/Dev/bofdi/site/edit/edit.pars:1:1
```

## Reproduction Steps

1. Create a Parsley file with an invalid import:
```parsley
{request, query} = import @basil/http
```
(`@basil/http` exports `request` but not `query`)

2. Load the page
3. Observe error shows `line 0:0`

## Investigation Notes

Root cause identified in two locations:

1. **evalStdlibModuleDestructuring** in `stdlib_table.go:361`:
   - Creates error with `newUndefinedError("UNDEF-0006", ...)` without position
   - Has access to `pattern` which has Token and Keys with Token info

2. **evalDictDestructuringAssignment** in `eval_expressions.go:780`:
   - Creates error with `newDestructuringError("DEST-0001", val)` without position
   - Has access to `pattern` which has Token info

Both functions have access to `pattern *ast.DictDestructuringPattern` which contains:
- `pattern.Token` - the `{` token with line/column
- `pattern.Keys[i].Token` - each key's token with line/column

## Resolution

**Commit**: 650f2da

Added position information (line, column, file) to both error paths:

1. **evalStdlibModuleDestructuring** in [stdlib_table.go](../../pkg/parsley/evaluator/stdlib_table.go):
   ```go
   err := newUndefinedError("UNDEF-0006", map[string]any{"Name": keyName})
   err.Line = keyPattern.Token.Line
   err.Column = keyPattern.Token.Column
   if env != nil && env.Filename != "" {
       err.File = env.Filename
   }
   ```

2. **evalDictDestructuringAssignment** in [eval_expressions.go](../../pkg/parsley/evaluator/eval_expressions.go):
   ```go
   err := newDestructuringError("DEST-0001", val)
   err.Line = pattern.Token.Line
   err.Column = pattern.Token.Column
   if env != nil && env.Filename != "" {
       err.File = env.Filename
   }
   ```

**Regression tests**: `TestImportErrorPositions` and `TestDestructuringTypeErrorPosition` in [import_syntax_test.go](../../pkg/parsley/tests/import_syntax_test.go)
