// Environment variables available in this template:
//
// error (Dictionary)
//   .code (Integer)          - HTTP status code (e.g., 500)
//   .message (String)        - HTTP status text (e.g., "Internal Server Error")
//   .message_text (String)   - Detailed error message
//   .details (String)        - Full error details (dev mode only)
//   .file (String)           - Source file path where error occurred (if available)
//   .line (Integer)          - Line number where error occurred (if available)
//   .column (Integer)        - Column number where error occurred (if available)
//   .source (Array)          - Source code context around the error (if available)
//     Each element is a Dictionary with:
//       .number (Integer)    - Line number
//       .content (String)    - Line content
//       .is_error (Boolean)  - true if this is the error line
//   .request (Dictionary)    - Request (dev mode only)
//     .method (String)       - HTTP method (e.g., "GET")
//     .path (String)         - Request path
//     .query (String)        - Query string
//
// basil (Dictionary)
//   .version (String)        - Basil version
//   .dev (Boolean)           - true if in development mode

<Page>
	<div class="scroll">
		<Header
			title={error.code}
			info={}
			back=""
			subtitle={if (error.file) (path(error.file ).basename ) + " : " + error.line else ""}
			actions=""
		/>
		<div class="box">
			<h3>error.code<Sp/>error.message.htmlEncode()</h3>
			if (error.message_text) {
				<hr/>
				<h4>"Error"</h4>
				if (error.file) {
					<div class="location">"@ " + error.file + " >> " + error.line + " : " + error.column</div>
				}
				<div class="box"><p><code style="background:none">error.message_text.htmlEncode()</code></p></div>

			}

			if (error.source) {
				lines = error.source
				finalLineWidth = toString(lines[-1].number).length()
				<hr/>
				<h3>"Source Code"</h3>
				<pre class="code-block">
					for (line in lines) {
						thisLineWidth = toString(line.number).length()
						let pad = if (thisLineWidth < finalLineWidth) " " else ""
						if (line.is_error) {
							<span class="line-error">pad + line.number + "| " + line
								.content
								.htmlEncode() + " <-- ERROR"</span>
							<br/>
						} else {
							<span class="line-number">pad + line.number</span>
							"| " + line.content.htmlEncode()
							<br/>
						}
					}
				</pre>
			}
			<br/>

		</div>
		if (error.request) {
			<div class="box">
				<h3>"Request"</h3>
				<table style="width: 0 !important">
					<tr>
						<td>"Method"</td>
						<td><code style="background:none">error.request.method</code></td>
					</tr>
					<tr>
						<td>"Path"</td>
						<td><code style="background:none">error.request.path</code></td>
					</tr>
					if (error.request.query) {
						<tr>
							<td>"Query"</td>
							<td>error.request.query</td>
						</tr>
					}
				</table>
				<br/>
			</div>
		}

		<div class="box">
			<h3>"Server"</h3>
				<table style="width: 0 !important">
				<tr>
					<td>"Version"</td>
					<td><code style="background:none">basil.version</code></td>
				</tr>
				<tr>
					<td>"Mode"</td>
					<td><code style="background:none">"development"</code></td>
				</tr>
				</table>
			<br/>
		</div>
	</div>
</Page>
