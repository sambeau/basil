// Environment variables available in this template:
//
// error (Dictionary)
//   .code (Integer)          - HTTP status code (e.g., 500)
//   .message (String)        - HTTP status text (e.g., "Internal Server Error")
//   .message_text (String)   - Detailed error message
//   .details (String)        - Full error details (dev mode only)
//   .file (String)           - Source file path where error occurred (if available)
//   .line (Integer)          - Line number where error occurred (if available)
//   .column (Integer)        - Column number where error occurred (if available)
//   .source (Array)          - Source code context around the error (if available)
//     Each element is a Dictionary with:
//       .number (Integer)    - Line number
//       .content (String)    - Line content
//       .is_error (Boolean)  - true if this is the error line
//   .request (Dictionary)    - Request information (dev mode only)
//     .method (String)       - HTTP method (e.g., "GET")
//     .path (String)         - Request path
//     .query (String)        - Query string
//
// basil (Dictionary)
//   .version (String)        - Basil version
//   .dev (Boolean)           - true if in development mode

<<Page>
	<div class="container">
		<h1>
			<span class="error-code">error.code</span>
			error.message.htmlEncode() 
		</h1>
		if (error.message_text) {
			<div class="section">
				<h2>"Error Details"</h2>
				<div class="message">error.message_text.htmlEncode() </div>
				if (error.file) {
					<div class="location">
						"at " + error.file + ":" + error.line + ":" + error.column
					</div>
				}
			</div>
		}
		
		if (error.source) {
			lines = error.source
			finalLineWidth = toString(lines[-1].number).length()
			<div class="section">
				<h2>"Source Code"</h2>
				<pre class="code-block">
					for (line in lines) {
						thisLineWidth = toString(line.number).length()
						let pad = if (thisLineWidth < finalLineWidth) " " else ""
						if (line.is_error) {
							<span class="line-error">pad + line.number + "| " + line.content.htmlEncode() + " <-- ERROR"</span><br/>
						} else {
							<span class="line-number">pad + line.number</span>"| " + line.content.htmlEncode()<br/>
						}
					}
				</pre>	
			</div>
		}
		
		if (error.request) {
			<div class="section">
				<h2>"Request Information"</h2>
				<div class="request-info">
					<div class="request-row">
						<div class="request-label">"Method:"</div>
						<div class="request-value">error.request.method</div>
					</div>
					<div class="request-row">
						<div class="request-label">"Path:"</div>
						<div class="request-value">error.request.path</div>
					</div>
					if (error.request.query) {
						<div class="request-row">
							<div class="request-label">"Query:"</div>
							<div class="request-value">error.request.query</div>
						</div>
					}
				</div>
			</div>
		}
		
		<div class="section">
			<h2>"Server Information"</h2>
			<div class="request-info">
				<div class="request-row">
					<div class="request-label">"Version:"</div>
					<div class="request-value">basil.version</div>
				</div>
				<div class="request-row">
					<div class="request-label">"Mode:"</div>
					<div class="request-value">"development"</div>
				</div>
			</div>
		</div>
	</div>
<Page>

